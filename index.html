<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>All-in-One PDF Tool (Mouse Wheel Zoom)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>

<style>
body{margin:0;font-family:Inter,system-ui;background:#f1f5f9}
header{background:linear-gradient(135deg,#1e3a8a,#2563eb);color:#fff;padding:16px;text-align:center}
.container{max-width:1200px;margin:20px auto;padding:16px}
.card{background:#fff;border-radius:16px;padding:16px;box-shadow:0 10px 25px rgba(0,0,0,.1)}
.controls{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
input[type=file]{padding:10px}
button{padding:10px 16px;border:none;border-radius:10px;font-weight:600;background:#2563eb;color:white;cursor:pointer}
button.secondary{background:#16a34a}
button.danger{background:#dc2626}

.pages{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:14px;margin-top:20px}
.page{background:#f8fafc;border-radius:12px;padding:8px;cursor:pointer}
.page canvas{width:100%;border-radius:8px}
.actions{display:flex;justify-content:space-between;align-items:center;margin-top:6px}
small{color:#475569}

@media(max-width:600px){.pages{grid-template-columns:repeat(2,1fr)}}

/* FULL SCREEN MODAL */
.modal{
  position:fixed; inset:0;
  background:rgba(0,0,0,.9);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:9999;
}
.modal-content{
  background:#111;
  padding:10px;
  border-radius:12px;
  max-width:95vw;
  max-height:95vh;
  overflow:auto;
}
.modal canvas{
  display:block;
  margin:auto;
}
.modal-controls{
  display:flex;
  justify-content:space-between;
  margin-bottom:8px;
}
</style>
</head>

<body>
<header>
<h2>üìÑ All-in-One PDF Tool</h2>
<p>Add ‚Ä¢ Preview ‚Ä¢ Reorder ‚Ä¢ Full Screen ‚Ä¢ Mouse Scroll Zoom</p>
</header>

<div class="container">
<div class="card">

<div class="controls">
  <input type="file" id="pdfInput" accept="application/pdf">
  <button onclick="addPDF()">‚ûï Add PDF</button>

  <button class="secondary" onclick="mergeAll()">üîó Merge</button>
  <button onclick="splitSelected()">‚úÇÔ∏è Split</button>
</div>

<div class="pages" id="pages"></div>

</div>
</div>

<!-- FULL SCREEN PREVIEW -->
<div class="modal" id="previewModal">
  <div class="modal-content" id="modalBox">
    <div class="modal-controls">
      <button onclick="zoomModal(0.1)">‚ûï</button>
      <button onclick="zoomModal(-0.1)">‚ûñ</button>
      <button class="danger" onclick="closeModal()">‚úñ Close</button>
    </div>
    <canvas id="modalCanvas"></canvas>
  </div>
</div>

<script>
const { PDFDocument } = PDFLib;

let pdfDocs=[], pdfJsDocs=[];
let zoomThumb=0.5;
let modalScale=1;
let modalPage=null;
let sortable;

// ADD PDF ONE BY ONE
async function addPDF(){
  const file=pdfInput.files[0];
  if(!file) return alert("Select a PDF");

  const bytes=await file.arrayBuffer();
  const idx=pdfDocs.length;

  pdfDocs.push(await PDFDocument.load(bytes));
  pdfJsDocs.push(await pdfjsLib.getDocument({data:bytes}).promise);

  const pdf=pdfJsDocs[idx];
  for(let p=1;p<=pdf.numPages;p++) createPage(idx,p-1);

  if(sortable) sortable.destroy();
  sortable=new Sortable(pages,{animation:150});
  pdfInput.value='';
}

// CREATE THUMBNAIL PAGE
async function createPage(pdfIndex,pageIndex){
  const div=document.createElement('div');
  div.className='page';
  div.dataset.pdf=pdfIndex;
  div.dataset.page=pageIndex;

  div.innerHTML=`
    <canvas></canvas>
    <div class="actions">
      <input type="checkbox">
      <button class="danger" onclick="this.closest('.page').remove()">‚úñ</button>
    </div>
    <small>PDF ${pdfIndex+1} ‚Ä¢ Page ${pageIndex+1}</small>`;

  div.onclick=e=>{
    if(e.target.tagName!=='INPUT' && e.target.tagName!=='BUTTON')
      openModal(div);
  };

  pages.appendChild(div);
  renderThumb(div);
}

// RENDER THUMB
async function renderThumb(div){
  const pdf=pdfJsDocs[div.dataset.pdf];
  const page=await pdf.getPage(+div.dataset.page+1);
  const vp=page.getViewport({scale:zoomThumb});
  const c=div.querySelector('canvas');
  c.width=vp.width; c.height=vp.height;
  await page.render({canvasContext:c.getContext('2d'),viewport:vp}).promise;
}

// FULL SCREEN PREVIEW
async function openModal(div){
  modalPage=div;
  modalScale=1;
  previewModal.style.display='flex';
  renderModal();
}

// RENDER MODAL PAGE
async function renderModal(){
  const pdf=pdfJsDocs[modalPage.dataset.pdf];
  const page=await pdf.getPage(+modalPage.dataset.page+1);
  const vp=page.getViewport({scale:modalScale});
  const c=modalCanvas;
  c.width=vp.width; c.height=vp.height;
  await page.render({canvasContext:c.getContext('2d'),viewport:vp}).promise;
}

// BUTTON ZOOM
function zoomModal(delta){
  modalScale=Math.min(5,Math.max(0.3,modalScale+delta));
  renderModal();
}

// MOUSE WHEEL ZOOM (IMPORTANT)
modalBox.addEventListener('wheel',e=>{
  e.preventDefault();
  modalScale += (e.deltaY < 0 ? 0.1 : -0.1);
  modalScale=Math.min(5,Math.max(0.3,modalScale));
  renderModal();
},{passive:false});

// CLOSE MODAL
function closeModal(){
  previewModal.style.display='none';
}

// MERGE
async function mergeAll(){
  if(!pages.children.length) return alert("No pages");
  const out=await PDFDocument.create();
  for(const div of pages.children){
    const [p]=await out.copyPages(pdfDocs[div.dataset.pdf],[+div.dataset.page]);
    out.addPage(p);
  }
  download(await out.save(),'merged.pdf');
}

// SPLIT
async function splitSelected(){
  const sel=[...document.querySelectorAll('.page')].filter(p=>p.querySelector('input').checked);
  if(!sel.length) return alert("Select pages");
  const out=await PDFDocument.create();
  for(const div of sel){
    const [p]=await out.copyPages(pdfDocs[div.dataset.pdf],[+div.dataset.page]);
    out.addPage(p);
  }
  download(await out.save(),'split.pdf');
}

function download(bytes,name){
  const a=document.createElement('a');
  a.href=URL.createObjectURL(new Blob([bytes],{type:'application/pdf'}));
  a.download=name; a.click();
}

// ESC TO CLOSE
document.addEventListener('keydown',e=>{
  if(e.key==='Escape') closeModal();
});
</script>
</body>
</html>
