<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>All-in-One PDF Tool ‚Äì Preview, Zoom & Merge</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<!-- Libraries -->
<script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>

<style>
body{margin:0;font-family:Inter,system-ui;background:#f1f5f9}
header{background:linear-gradient(135deg,#1e3a8a,#2563eb);color:#fff;padding:16px;text-align:center}
.container{max-width:1200px;margin:20px auto;padding:16px}
.card{background:#fff;border-radius:16px;padding:16px;box-shadow:0 10px 25px rgba(0,0,0,.1)}
.controls{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
input[type=file]{padding:10px}
button{padding:10px 16px;border:none;border-radius:10px;font-weight:600;background:#2563eb;color:white;cursor:pointer}
button.danger{background:#dc2626}
button.secondary{background:#16a34a}
label{font-weight:600;font-size:14px}
.pages{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:14px;margin-top:20px}
.page{background:#f8fafc;border-radius:12px;padding:8px;cursor:grab}
.page canvas{width:100%;border-radius:8px}
.actions{display:flex;justify-content:space-between;align-items:center;margin-top:6px}
small{color:#475569}
@media(max-width:600px){.pages{grid-template-columns:repeat(2,1fr)}}
</style>
</head>

<body>
<header>
<h2>üìÑ All-in-One PDF Tool</h2>
<p>Multi-PDF Merge ‚Ä¢ Preview ‚Ä¢ Zoom ‚Ä¢ Drag & Drop ‚Ä¢ Delete ‚Ä¢ Split ‚Ä¢ Reorder</p>
</header>

<div class="container">
<div class="card">

<div class="controls">
  <input type="file" id="pdfInput" multiple accept="application/pdf">
  <button onclick="loadPDFs()">Load PDFs</button>

  <label>üîç Zoom</label>
  <input type="range" id="zoomRange" min="0.2" max="1.2" step="0.1" value="0.4" oninput="updateZoom(this.value)">

  <button class="secondary" onclick="mergeAll()">üîó Merge All</button>
  <button onclick="splitSelected()">‚úÇÔ∏è Split Selected</button>
</div>

<div class="pages" id="pages"></div>

</div>
</div>

<script>
const { PDFDocument } = PDFLib;
let pdfDocs = [];
let pdfFiles = [];
let zoomLevel = 0.4;

async function loadPDFs(){
  const files = pdfInput.files;
  if(!files.length){alert('Select multiple PDFs');return;}

  pages.innerHTML = '';
  pdfDocs = [];
  pdfFiles = [];

  for(let fIndex=0; fIndex<files.length; fIndex++){
    const bytes = await files[fIndex].arrayBuffer();
    pdfDocs.push(await PDFDocument.load(bytes));
    pdfFiles.push(bytes);

    const pdfjs = await pdfjsLib.getDocument({data:bytes}).promise;

    for(let p=1; p<=pdfjs.numPages; p++){
      await renderPage(pdfjs, fIndex, p);
    }
  }

  new Sortable(pages,{animation:150});
}

async function renderPage(pdfjs, fIndex, p){
  const page = await pdfjs.getPage(p);
  const viewport = page.getViewport({scale:zoomLevel});
  const canvas = document.createElement('canvas');
  canvas.width = viewport.width;
  canvas.height = viewport.height;

  await page.render({canvasContext:canvas.getContext('2d'),viewport}).promise;

  const div = document.createElement('div');
  div.className = 'page';
  div.dataset.pdf = fIndex;
  div.dataset.page = p-1;

  div.innerHTML = `
    <canvas></canvas>
    <div class="actions">
      <input type="checkbox">
      <button class="danger" onclick="this.closest('.page').remove()">‚úñ</button>
    </div>
    <small>PDF ${fIndex+1} ‚Ä¢ Page ${p}</small>
  `;

  div.querySelector('canvas').replaceWith(canvas);
  pages.appendChild(div);
}

function updateZoom(z){
  zoomLevel = parseFloat(z);
  reloadPreview();
}

async function reloadPreview(){
  const existing = [...document.querySelectorAll('.page')]
    .map(d=>({pdf:d.dataset.pdf,page:d.dataset.page,checked:d.querySelector('input').checked}))

  pages.innerHTML='';

  for(const e of existing){
    const pdfjs = await pdfjsLib.getDocument({data:pdfFiles[e.pdf]}).promise;
    const page = await pdfjs.getPage(parseInt(e.page)+1);
    const viewport = page.getViewport({scale:zoomLevel});
    const canvas = document.createElement('canvas');
    canvas.width = viewport.width;
    canvas.height = viewport.height;

    await page.render({canvasContext:canvas.getContext('2d'),viewport}).promise;

    const div = document.createElement('div');
    div.className='page';
    div.dataset.pdf=e.pdf;
    div.dataset.page=e.page;

    div.innerHTML=`
      <canvas></canvas>
      <div class="actions">
        <input type="checkbox" ${e.checked?'checked':''}>
        <button class="danger" onclick="this.closest('.page').remove()">‚úñ</button>
      </div>
      <small>PDF ${parseInt(e.pdf)+1} ‚Ä¢ Page ${parseInt(e.page)+1}</small>`;

    div.querySelector('canvas').replaceWith(canvas);
    pages.appendChild(div);
  }

  new Sortable(pages,{animation:150});
}

async function mergeAll(){
  if(!pages.children.length){alert('No pages');return;}

  const out = await PDFDocument.create();

  for(const div of pages.children){
    const srcPdf = pdfDocs[div.dataset.pdf];
    const pageIndex = parseInt(div.dataset.page);
    const [copied] = await out.copyPages(srcPdf,[pageIndex]);
    out.addPage(copied);
  }

  download(await out.save(),'merged.pdf');
}

async function splitSelected(){
  const selected = [...document.querySelectorAll('.page')]
    .filter(p=>p.querySelector('input').checked);

  if(!selected.length){alert('Select pages to split');return;}

  const out = await PDFDocument.create();

  for(const div of selected){
    const srcPdf = pdfDocs[div.dataset.pdf];
    const pageIndex = parseInt(div.dataset.page);
    const [copied] = await out.copyPages(srcPdf,[pageIndex]);
    out.addPage(copied);
  }

  download(await out.save(),'split.pdf');
}

function download(bytes,name){
  const blob = new Blob([bytes],{type:'application/pdf'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = name;
  a.click();
}
</script>
</body>
</html>
